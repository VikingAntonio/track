<!DOCTYPE html>       
<html lang="es">       
<head>       
    <meta charset="UTF-8">       
    <meta name="viewport" content="width=device-width, initial-scale=1.0">       
    <title>Generador de Plantillas</title>       
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>    
    <link rel="stylesheet" href="./assets/css/badge.css">  
    <style>       
        body {       
            font-family: 'Poppins', sans-serif;       
            display: flex;       
            justify-content: center;       
            align-items: center;       
            height: 100vh;       
            margin: 0;       
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);       
        }       
       
        .container {       
            text-align: center;       
            background-color: white;       
            padding: 40px 50px;       
            border-radius: 15px;       
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);       
            transition: transform 0.3s ease, box-shadow 0.3s ease;       
            max-width: 500px;       
            width: 90%;       
        }       
        .container:hover {       
            transform: translateY(-5px);       
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);       
        }       
        h1 {       
            color: #333;       
            font-weight: 600;       
            margin-bottom: 25px;       
        }       
       
        #drop-zone {       
            border: 2px dashed #dce4f0;       
            border-radius: 10px;       
            padding: 40px 20px;       
            cursor: pointer;       
            transition: all 0.3s ease;       
            position: relative;       
            background-color: #f8fafc;       
        }       
        #drop-zone p {       
            margin: 0;       
            color: #888;       
        }       
        #drop-zone::before {    
            content: '';    
            background-image: url("data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 121.86 122.88' style='enable-background:new 0 0 121.86 122.88' xml:space='preserve'%3E%3Cstyle type='text/css'%3E.st0{fill-rule:evenodd;clip-rule:evenodd;fill:%23888;}%3C/style%3E%3Cg%3E%3Cpath class='st0' d='M72.09,18.72h42.37c2.05,0,3.89,0.84,5.22,2.18c1.34,1.34,2.18,3.2,2.18,5.22v89.36 c0,2.05-0.84,3.89-2.18,5.22c-1.34,1.34-3.2,2.18-5.22,2.18H24.48c-2.05,0-3.89-0.84-5.22-2.18c-1.34-1.34-2.18-3.2-2.18-5.22 V71.46c2.47,1,5.05,1.78,7.72,2.29v20.28h0.03l0,0C37.72,81.7,46.26,75.61,59.08,65.2c0.05,0.05,0.1,0.1,0.15,0.15 c0.03,0.03,0.03,0.06,0.06,0.06l26.82,31.73l4.1-25.24c0.28-1.62,1.8-2.73,3.42-2.45c0.62,0.09,1.18,0.4,1.62,0.81l18.82,19.77 V27.91c0-0.4-0.16-0.75-0.44-0.99c-0.25-0.25-0.62-0.44-0.99-0.44H74.05C73.64,23.8,72.98,21.21,72.09,18.72L72.09,18.72z M32.79,0 C50.9,0,65.58,14.68,65.58,32.79c0,18.11-14.68,32.79-32.79,32.79C14.68,65.58,0,50.9,0,32.79C0,14.68,14.68,0,32.79,0L32.79,0z M15.37,33.37h11.04v15.76h12.45V33.37h11.36L32.8,16.44L15.37,33.37L15.37,33.37L15.37,33.37z M94.27,35.66 c2.95,0,5.66,1.21,7.58,3.14c1.96,1.96,3.14,4.63,3.14,7.59c0,2.95-1.21,5.66-3.14,7.58c-1.96-1.96-4.63,3.14-7.58,3.14 c-2.95,0-5.66-1.21-7.59-3.14c-1.96-1.96-3.14-4.63-3.14-7.58c0-2.95,1.21-5.65,3.14-7.59C88.65,36.84,91.32,35.66,94.27,35.66 L94.27,35.66L94.27,35.66z'/%3E%3C/g%3E%3C/svg%3E");    
            background-repeat: no-repeat;    
            background-size: contain;    
            background-position: center;    
            width: 60px;    
            height: 60px;    
            display: block;    
            margin: 0 auto 15px;    
            transition: transform 0.3s ease;    
        }    
       
        #drop-zone.drag-over {       
            border-color: #ff6600;       
            background-color: #fff4e0;       
        }       
        #drop-zone.drag-over::before {       
            transform: scale(1.1);       
        }       
       
        #download-btn {       
            margin-top: 25px;       
            padding: 12px 30px;       
            background-color: #ff6600;       
            color: white;       
            border: none;       
            border-radius: 8px;       
            cursor: pointer;       
            font-size: 16px;       
            font-weight: 600;       
            transition: all 0.3s ease;       
            position: relative;       
            min-width: 180px;       
            min-height: 48px;       
            overflow: hidden;       
        }       
       
        #download-btn:hover {       
            background-color: #e65c00;       
            transform: translateY(-2px);       
            box-shadow: 0 5px 15px rgba(255, 102, 0, 0.4);       
        }       
        #download-btn:active {       
            transform: translateY(0);       
            box-shadow: 0 2px 10px rgba(255, 102, 0, 0.3);       
        }       
       
        #download-btn.loading {       
            background-color: #e65c00;       
            cursor: not-allowed;       
        }       
       
        .spinner {       
            border: 3px solid rgba(255, 255, 255, 0.3);       
            border-radius: 50%;       
            border-top: 3px solid #fff;       
            width: 24px;       
            height: 24px;       
            animation: spin 1s linear infinite;       
            display: none;       
            position: absolute;       
            top: 50%;       
            left: 50%;       
            margin-top: -12px;       
            margin-left: -12px;       
        }       
       
        #download-btn.loading .spinner {       
            display: block;       
        }       
       
        #download-btn.loading .btn-text {       
            visibility: hidden;       
        }       
       
        @keyframes spin {       
            0% { transform: rotate(0deg); }       
            100% { transform: rotate(360deg); }       
        }       
       
        #preview {       
            border: 1px solid #eee;       
            border-radius: 8px;       
        }       
    </style>       
</head>       
<body>  
      <!-- ICONO Y BADGE (sin barra, con margen propio) -->  
<img id="login-icon" class="login-icon" src="./assets/img/user.svg">  
  
  <!-- Placa del usuario -->  
<div id="user-badge" class="user-badge hidden" style="position: fixed;">  
  <div id="badge-username"></div>  
  <div id="badge-role"></div>  
</div>  
  
<!-- Menú ahora fuera del badge -->  
<div id="badge-menu" class="hidden">  
  <button id="logout-btn" class="logout-btn">Cerrar sesión</button>  
</div>  
  
  
<!-- PANEL DE LOGIN -->  
<div id="login-panel" class="login-panel hidden">  
  
  <h3>Iniciar sesión</h3>  
  
  <input id="user" class="input" placeholder="Usuario">  
  <input id="pass" class="input" type="password" placeholder="Contraseña">  
  
  <button id="login-btn" class="login-btn">Entrar</button>  
  
  <!-- Estado del login -->  
  <div id="login-status" class="status"></div>  
</div>  
  
<!-- TU DRAWER -->  
<menutech-drawer id="main-drawer" class="hidden"></menutech-drawer>  
  
  
  <!-- NAVBAR NEOMÓRFICO INFERIOR -->  
<div class="neo-nav-container">  
    <button id="neoNavBack" class="neo-nav-btn">  
        <svg viewBox="0 0 24 24" class="neo-nav-icon">  
            <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2"  
                  fill="none" stroke-linecap="round" stroke-linejoin="round"/>  
        </svg>  
    </button>  
  
    <button id="neoNavHome" class="neo-nav-btn">  
        <svg viewBox="0 0 24 24" class="neo-nav-icon">  
            <path d="M3 11l9-7 9 7v8a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2v-4H9v4a2   
                     2 0 0 1-2 2H5a2 2 0 0 1-2-2z"  
                  stroke="currentColor" stroke-width="2" fill="none"  
                  stroke-linecap="round" stroke-linejoin="round"/>  
        </svg>  
    </button>  
</div>  
  <menutech-themes></menutech-themes>  
  <menutech-chatbot></menutech-chatbot>  
    <div class="container">       
        <img src="https://menutech.services/assets/img/logomt.png" alt="MenuTech Logo" style="max-width: 150px; margin-bottom: 20px;">       
        <h1>Sube tu Logo</h1>       
        <div id="drop-zone">       
            <p>Arrastra y suelta tu logo aquí, o haz clic para seleccionar un archivo.</p>       
            <input type="file" id="logo-input" accept="image/*" style="display: none;">       
        </div>       
        <img id="preview" src="#" alt="Vista previa de tu logo" style="display:none; max-width: 200px; margin-top: 20px;"/>       
        <button id="download-btn" style="display: none;">       
            <span class="btn-text">Descargar Archivos</span>       
            <div class="spinner"></div>       
        </button>       
    </div>       
       
    <!-- Hidden canvas for image processing -->       
    <canvas id="image-canvas" style="display: none;"></canvas>       
       
    <!-- Libraries -->       
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>       
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>       
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>       
    <script>       
        document.addEventListener('DOMContentLoaded', () => {       
    const { jsPDF } = window.jspdf;       
       
    function showModal(message, icon = 'info') {       
        Swal.fire({       
            title: message,       
            icon: icon,       
            confirmButtonColor: '#ff6600'       
        });       
    }       
       
    const dropZone = document.getElementById('drop-zone');       
    const logoInput = document.getElementById('logo-input');       
    const downloadBtn = document.getElementById('download-btn');       
    const preview = document.getElementById('preview');       
    const canvas = document.getElementById('image-canvas');       
    const ctx = canvas.getContext('2d');       
       
    let uploadedLogoFile = null;       
       
    // ======================================================================================       
    // ⭐⭐ BLOQUE DONDE PUEDES EDITAR FÁCILMENTE TUS COORDENADAS ⭐⭐       
    // Coordenadas EXACTAS como Illustrator (origen arriba/izquierda)       
    // ======================================================================================       
    const logoPlacements = [       
        { id: "logo1", x: 2062.6, y: 907.7, width: 150, height: 150, angle: -18.57 },       
        { id: "logo2", x: 1094.1, y: 1958.1, width: 113, height: 113, angle: 0 },       
        { id: "logo3", x: 1401.5, y: 2375.1, width: 107, height: 107, angle: -32.12 },       
        { id: "logo4", x: 1103.3, y: 2716.6, width: 190, height: 190, angle: -337.15 },       
        { id: "logo5", x: 2369.3, y: 1883.4, width: 80, height: 80, angle: -12.02 },       
        { id: "logo6", x: 2801.7, y: 2488.4, width: 85, height: 85, angle: 0 },       
        { id: "logo7", x: 3262, y: 2480, width: 56, height: 75, angle: 0 },       
        { id: "logo8", x: 3399, y: 2471, width: 80, height: 72, angle: 0 },       
        { id: "logo9", x: 3777.3, y: 2523.0, width: 80, height: 80, angle: -2.07 },       
        { id: "logo10", x: 3195.9, y: 965.0, width: 135, height: 135, angle: 0 },       
        { id: "logo11", x: 3724.8, y: 1039.8, width: 320, height: 320, angle: 0 },       
        { id: "logo12", x: 4800.4, y: -2.0, width: 935, height: 935, angle: 0 }      
    ];       
       
    const zipImagePlacements = [      
        {      
            src: './assets/img/tableQR2.png',      
            placements: [      
                { x: 537, y: 672, width: 217, height: 207, angle: 180 }      
            ]      
        },      
        {      
            src: './assets/img/poster.png',      
            placements: [      
                { x: 199, y: 289, width: 108, height: 108 },      
                { x: 708, y: 288, width: 108, height: 108 }      
            ]      
        },      
        {      
            src: './assets/img/flyer.png',      
            placements: [      
                { x: 8, y: 296, width: 166, height: 166 },      
                { x: 518, y: 297, width: 166, height: 166 }      
            ]      
        },      
        {      
            src: './assets/img/st.png',      
            placements: [      
                { x: 174, y: 608, width: 247, height: 247, flipDirection: 'horizontal' },     
                { x: 774, y: 606, width: 247, height: 247, flipDirection: 'horizontal' }     
            ]      
        },      
        {      
            src: './assets/img/shirt.png',      
            placements: [      
                { x: 330, y: 357, width: 129, height: 129, flipDirection: 'vertical' },     
                { x: 645, y: 251, width: 223, height: 223, flipDirection: 'vertical' }     
            ]      
        },     
        {      
            src: './assets/img/m1.png',      
            placements: [      
                { x: 60, y: 85, width: 498, height: 663 }   
            ]      
        }, 
        {      
            src: './assets/img/xbanner.png',      
            placements: [      
                {  
                    x: 265, y: 1515, width: 494, height: 494,  
                     
                    // --- Opciones de Transformación --- 
                    // Rotación: 'angle' puede ser cualquier número (ej: 0, 90, 180, 270). 
                   // angle: 180, 
 
                    // Efecto Espejo: Descomenta la línea que necesites para activarlo. 
                    // flipDirection: 'horizontal', // Para volteo horizontal. 
                     flipDirection: 'vertical',   // Para volteo vertical. 
                } 
            ]      
        }, 
        {      
            src: './assets/img/flag.png',      
            placements: [      
                {  
                    x: 266, y: 362, width: 264, height: 264, 
                     
                    // --- Opciones de Transformación --- 
                    // Rotación: Descomenta la línea y asigna un valor (ej: 0, 90, 180). 
                    // angle: 0, 
 
                    // Efecto Espejo: 'vertical' está activo por defecto. 
                    // Puedes cambiarlo a 'horizontal' o comentarlo para quitar el efecto. 
                    flipDirection: 'vertical',   // Para volteo vertical. 
                    // flipDirection: 'horizontal', // Para volteo horizontal. 
                } 
            ]      
        },
        {      
            src: './assets/img/banner.png',      
            placements: [      
                {  
                    x: 176, y: 675, width: 123, height: 123, 
                     
                    // --- Opciones de Transformación --- 
                    // Rotación: Descomenta la línea y asigna un valor (ej: 0, 90, 180). 
                    // angle: 0, 
 
                    // Efecto Espejo: Puedes cambiarlo a 'horizontal' o comentarlo para quitar el efecto. 
                    flipDirection: 'vertical',   // Para volteo vertical. 
                    // flipDirection: 'horizontal', // Para volteo horizontal. 
                },
                {  
                    x: 643, y: 649, width: 148, height: 148, 
                     
                    // --- Opciones de Transformación --- 
                    // Rotación: Descomenta la línea y asigna un valor (ej: 0, 90, 180). 
                    // angle: 0, 
 
                    // Efecto Espejo: Puedes cambiarlo a 'horizontal' o comentarlo para quitar el efecto. 
                    flipDirection: 'vertical',   // Para volteo vertical. 
                    // flipDirection: 'horizontal', // Para volteo horizontal. 
                }
            ]      
        }
    ];      
    // ======================================================================================       
       
       
    function handleFile(file) {       
        if (!file.type.startsWith('image/')) {       
            showModal('Por favor, sube un archivo de imagen.');       
            return;       
        }       
        uploadedLogoFile = file;       
        const reader = new FileReader();       
        reader.onload = (e) => {       
            preview.src = e.target.result;       
            preview.style.display = 'block';       
            downloadBtn.style.display = 'inline-block';       
        };       
        reader.readAsDataURL(file);       
        dropZone.querySelector('p').textContent = `Archivo seleccionado: ${file.name}`;       
    }       
       
    dropZone.addEventListener('dragover', (e) => {       
        e.preventDefault();       
        dropZone.classList.add('drag-over');       
    });       
    dropZone.addEventListener('dragleave', () => {       
        dropZone.classList.remove('drag-over');       
    });       
    dropZone.addEventListener('drop', (e) => {       
        e.preventDefault();       
        dropZone.classList.remove('drag-over');       
        const files = e.dataTransfer.files;       
        if (files.length > 0) handleFile(files[0]);       
    });       
    dropZone.addEventListener('click', () => logoInput.click());       
    logoInput.addEventListener('change', () => {       
        if (logoInput.files.length > 0) handleFile(logoInput.files[0]);       
    });       
       
    function toggleLoading(isLoading) {       
        if (isLoading) {       
            downloadBtn.classList.add('loading');       
            downloadBtn.disabled = true;       
            downloadBtn.querySelector('.btn-text').textContent = 'Generando...';       
        } else {       
            downloadBtn.classList.remove('loading');       
            downloadBtn.disabled = false;       
            downloadBtn.querySelector('.btn-text').textContent = 'Descargar Archivos';       
        }       
    }       
       
    downloadBtn.addEventListener('click', async () => {     
        if (!uploadedLogoFile) {     
            showModal('Por favor, sube un logo primero.');     
            return;     
        }     
     
        toggleLoading(true);     
     
        try {     
            // Generate PDF     
             await new Promise((resolve, reject) => {     
                const baseImage = new Image();     
                baseImage.crossOrigin = "Anonymous";     
                baseImage.src = './assets/img/Mesa de trabajo.png';     
     
                baseImage.onload = () => {     
                    canvas.width = baseImage.naturalWidth;     
                    canvas.height = baseImage.naturalHeight;     
                    ctx.clearRect(0, 0, canvas.width, canvas.height);     
                    ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);     
     
                    const userLogo = new Image();     
                    userLogo.src = URL.createObjectURL(uploadedLogoFile);     
     
                    userLogo.onload = () => {     
                        logoPlacements.forEach(p => {     
                            const scale = Math.min(p.width / userLogo.width, p.height / userLogo.height);     
                            const drawWidth = userLogo.width * scale;     
                            const drawHeight = userLogo.height * scale;     
                            const centerX = p.x + p.width / 2;     
                            const centerY = p.y + p.height / 2;     
                            ctx.save();     
                            ctx.translate(centerX, centerY);     
                            ctx.rotate(p.angle * Math.PI / 180);     
                            ctx.drawImage(userLogo, -drawWidth / 2, -drawHeight / 2, drawWidth, drawHeight);     
                            ctx.restore();     
                        });     
                        generatePdf();     
                        resolve();     
                    };     
                    userLogo.onerror = () => reject(new Error('Hubo un error al cargar tu logo.'));     
                };     
                baseImage.onerror = () => reject(new Error('Hubo un error al cargar la imagen de la plantilla base.'));     
            });     
            // Generate ZIP after a delay     
            await new Promise(resolve => setTimeout(resolve, 500));     
            await generateZip();     
     
            Swal.fire({    
                title: '¡Descarga completada!',    
                text: 'Tus archivos se han descargado con éxito.',    
                icon: 'success',    
                confirmButtonText: '¿Quieres renderizar los productos 3D?',    
                confirmButtonColor: '#ff6600',    
                showClass: {    
                    popup: 'animate__animated animate__fadeInDown'    
                },    
                hideClass: {    
                    popup: 'animate__animated animate__fadeOutUp'    
                }    
            }).then((result) => {    
                if (result.isConfirmed) {    
                    window.location.href = './render3D.html';    
                }    
            });    
    
        } catch (error) {     
            console.error(error);     
            showModal(`Ocurrió un error: ${error.message}`);     
        } finally {     
            toggleLoading(false);     
        }     
    });       
       
     function generatePdf() {       
        try {       
            const canvasImage = canvas.toDataURL('image/png', 1.0);       
            const pdf = new jsPDF({       
                orientation: 'landscape',       
                unit: 'px',       
                format: [canvas.width, canvas.height]       
            });       
       
            pdf.addImage(canvasImage, 'PNG', 0, 0, canvas.width, canvas.height);       
            pdf.save('Brand book for Menutech.pdf');       
       
        } catch (error) {       
            console.error(error);       
            showModal(`Ocurrió un error: ${error.name} - ${error.message}`);       
            throw error;       
        }       
    }       
           
    async function generateZip() {     
        try {     
            const zip = new JSZip();     
            const userLogo = new Image();     
            userLogo.crossOrigin = "Anonymous";     
            userLogo.src = URL.createObjectURL(uploadedLogoFile);     
     
            await new Promise((resolve, reject) => {     
                userLogo.onload = resolve;     
                userLogo.onerror = () => reject(new Error('No se pudo cargar la imagen del logo.'));     
            });     
     
            for (const imageInfo of zipImagePlacements) {     
                try {     
                    const baseImage = new Image();     
                    baseImage.crossOrigin = "Anonymous";     
                    baseImage.src = imageInfo.src;     
                    await new Promise((resolve, reject) => {     
                        baseImage.onload = resolve;     
                        baseImage.onerror = () => reject(new Error(`No se pudo cargar la imagen de la plantilla: ${imageInfo.src}`));     
                    });     
     
                    canvas.width = baseImage.naturalWidth;     
                    canvas.height = baseImage.naturalHeight;     
                    ctx.clearRect(0, 0, canvas.width, canvas.height);     
                    ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);     
     
                    for (const p of imageInfo.placements) {     
                        const scale = Math.min(p.width / userLogo.width, p.height / userLogo.height);     
                        const drawWidth = userLogo.width * scale;     
                        const drawHeight = userLogo.height * scale;     
                        const centerX = p.x + p.width / 2;     
                        const centerY = p.y + p.height / 2;     
     
                        ctx.save();     
                        ctx.translate(centerX, centerY);     
                        if (p.flipDirection === 'vertical') {     
                            ctx.scale(1, -1);     
                        } else if (p.flipDirection === 'horizontal') {     
                            ctx.scale(-1, 1);     
                        }     
                        ctx.rotate((p.angle || 0) * Math.PI / 180);     
                        ctx.drawImage(userLogo, -drawWidth / 2, -drawHeight / 2, drawWidth, drawHeight);     
                        ctx.restore();     
                    }     
     
                    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));     
                    const filename = imageInfo.src.substring(imageInfo.src.lastIndexOf('/') + 1);     
                    zip.file(filename, blob);     
                } catch (error) {     
                    console.error(`Error procesando la imagen ${imageInfo.src}:`, error);     
                    throw error;      
                }     
            }     
     
            const content = await zip.generateAsync({ type: 'blob' });     
            const link = document.createElement('a');     
            link.href = URL.createObjectURL(content);     
            link.download = 'menutech_images.zip';     
            document.body.appendChild(link);     
            link.click();     
            document.body.removeChild(link);     
     
        } catch (error) {     
            console.error('Error generando el archivo ZIP:', error);     
            throw new Error(`Hubo un error al generar el archivo ZIP: ${error.message}`);     
        }     
    }     
});       
       
    </script>    
    <script src="./assets/js/badge.js"></script>  
  <script src="https://menutech.xyz/menutechUI.min.js"></script>  
  <script src="./assets/js/renderer.js"></script>     
</body>       
</html>      
